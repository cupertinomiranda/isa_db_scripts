<%
  require 'rubygems'
load 'init.rb'
%>
<% BitReplacement.each do |bit_repl| %>

/* type = <%= bit_repl.name %> mask = <%= bit_repl.replacement_mask.mask %> */
#ifndef INSERT_<%= bit_repl.name.upcase %>
#define INSERT_<%= bit_repl.name.upcase %>
static unsigned
insert_<%= bit_repl.name.downcase %>(
  unsigned insn ATTRIBUTE_UNUSED,
  int value ATTRIBUTE_UNUSED,
  const char **errmsg ATTRIBUTE_UNUSED) {
<% if(bit_repl.ignore_bits > 0) %>
  if(value & <%= "0x%02x" % ((2**bit_repl.ignore_bits) - 1) %>)
    *errmsg = _("Target address is not <%= 8*(2**bit_repl.ignore_bits)%>bit aligned.");<% end %>
<% bit_repl.replacements do |symbol_used, loc, repl_mask| %>
  insn |= ((value >> <%= symbol_used %>) & <%= repl_mask %>) << <%= loc %>;<% end %>

  return insn;
}
#endif /* INSERT_<%= bit_repl.name.upcase %> */

#ifndef EXTRACT_<%= bit_repl.name.upcase %>
#define EXTRACT_<%= bit_repl.name.upcase %>
static int
extract_<%= bit_repl.name %>(
  unsigned insn ATTRIBUTE_UNUSED,
  int *invalid ATTRIBUTE_UNUSED) {
  /* mask = <%= bit_repl.replacement_mask.mask %> */
  int value = 0
	<% bit_repl.replacements do |symbol_used, loc, repl_mask| %>
  value |= ((inst >> <%= loc %>) & <%= repl_mask %>) << <%= symbol_used %>;<% end %>

  return value;
}
#endif /* EXTRACT_<%= bit_repl.name.upcase %> */
<% end %>
